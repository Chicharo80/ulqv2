<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VISITASULQ ‚Äî Control de Acceso</title>

<style>
:root{
  --primary:#6a1b9a;
  --secondary:#ede7f6;
  --success:#2e7d32;
  --danger:#c62828;
}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#f3f7fb;
}
.wrap{
  max-width:720px;
  margin:auto;
  padding:16px;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
}
h1{
  text-align:center;
  color:var(--primary);
  margin-top:0;
}
label{
  display:block;
  margin-top:14px;
  font-weight:700;
}
input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:16px;
  margin-top:6px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-top:10px;
}
.btn-chip{
  padding:12px;
  border-radius:12px;
  text-align:center;
  font-weight:800;
  cursor:pointer;
  color:#fff;
}
.app{background:#1976d2}
.food{background:#f57c00}
.auto{background:#d32f2f}
.moto{background:#7b1fa2}
.trip{background:#fbc02d;color:#333}
.walk{background:#2e7d32}

.btn-chip.active{
  outline:3px solid #00000030;
}

button{
  width:100%;
  margin-top:16px;
  padding:14px;
  border:none;
  border-radius:14px;
  background:var(--primary);
  color:#fff;
  font-size:17px;
  font-weight:900;
  cursor:pointer;
}
button:disabled{opacity:.6}

.msg{
  text-align:center;
  margin-top:14px;
  font-weight:700;
}
.qr img{
  display:block;
  margin:14px auto;
  width:220px;
}
.code{
  text-align:center;
  font-size:20px;
  font-weight:900;
}
.btn-whats{
  background:#25D366;
}
.btn-reset{
  background:#5e35b1;
}
.hidden{display:none}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <h1>üîê VISITASULQ</h1>

    <label>Clave Casa</label>
    <input id="claveCasa" placeholder="VIOLETAS8">

    <label>Motivo</label>
    <div class="grid">
      <div class="btn-chip app" onclick="setMotivo(this,'APP')">üì± App</div>
      <div class="btn-chip food" onclick="setMotivo(this,'COMIDA')">üçî Comida</div>
      <div class="btn-chip trip" onclick="setMotivo(this,'VIAJE')">üöï Viaje</div>
      <div class="btn-chip auto" onclick="setMotivo(this,'AUTO')">üöó Auto</div>
      <div class="btn-chip moto" onclick="setMotivo(this,'MOTO')">üèç Moto</div>
      <div class="btn-chip walk" onclick="setMotivo(this,'PEATONAL')">üö∂ Peatonal</div>
    </div>

    <label>Duraci√≥n</label>
    <div class="grid">
      <div class="btn-chip app" onclick="setDur('15m')">15 min</div>
      <div class="btn-chip app" onclick="setDur('30m')">30 min</div>
      <div class="btn-chip app" onclick="setDur('1h')">1 hora</div>
      <div class="btn-chip app" onclick="setDur('24h')">24 hrs</div>
    </div>

    <label>Nombre (opcional)</label>
    <input id="nombre">

    <label>Tel√©fono (opcional)</label>
    <input id="telefono">

    <button onclick="generar()">üé´ GENERAR C√ìDIGO</button>

    <div id="msg" class="msg"></div>

    <div id="resultado" class="hidden">
      <div class="qr" id="qr"></div>
      <div class="code" id="codigo"></div>

      <button class="btn-whats" onclick="enviarWhats()">üì≤ ENVIAR WHATSAPP</button>
      <button class="btn-reset" onclick="reset()">üîÑ GENERAR OTRO</button>
    </div>

  </div>
</div>

<script>
const ENDPOINT = "https://script.google.com/macros/s/AKfycbyXzOz9CFLdT6zqQCDQgkn6kEV2dNhbhRq4Oe3Q6HBYlOxNXdEGniCUXcKHPb6Q_2S0/exec";

let motivo="", duracion="", codigoActual="", qrActual="";

function setMotivo(el,val){
  motivo = val;
  document.querySelectorAll(".btn-chip").forEach(b=>b.classList.remove("active"));
  el.classList.add("active");
}

function setDur(val){
  duracion = val;
}

function generar(){
  if(!motivo || !duracion){
    alert("Selecciona motivo y duraci√≥n");
    return;
  }

  const payload = {
    accion:"generarCodigo",
    claveCasa:claveCasa.value.trim(),
    motivo,
    duracion,
    nombre:nombre.value.trim(),
    telefono:telefono.value.trim()
  };

  msg.textContent="Generando c√≥digo...";

  fetch(ENDPOINT,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(payload)
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.ok){
      codigoActual=res.codigo;
      qrActual=res.qr;
      qr.innerHTML=`<img src="${qrActual}">`;
      codigo.textContent=codigoActual;
      resultado.classList.remove("hidden");
      msg.textContent="C√≥digo generado correctamente";
    }else{
      msg.textContent=res.message||"Error";
    }
  })
  .catch(()=>{
    msg.textContent="Error de conexi√≥n";
  });
}

function enviarWhats(){
  const tel=telefono.value.replace(/\D/g,"");
  const texto=`C√≥digo de acceso: ${codigoActual}`;
  window.open(`https://wa.me/${tel}?text=${encodeURIComponent(texto)}`);
}

function reset(){
  location.reload();
}
</script>
</body>
</html>
